The code is much cleaner now.