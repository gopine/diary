Trying to improve the type safety of our utility functions.

The documentation is a bit confusing.