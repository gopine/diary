Practicing complex type definitions.

Refactoring some existing code to use generics.

Solved a tricky TypeScript generics problem!