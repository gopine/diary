Practicing refactoring techniques.

Trying to avoid code smells.

Refactoring a messy function.