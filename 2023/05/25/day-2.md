Fixed errors in the notification implementation.

Making sure notifications are secure.

Adding security checks for messages.