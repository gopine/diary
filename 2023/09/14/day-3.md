Refactored some old code to improve readability and maintainability.